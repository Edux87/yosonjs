yOSON.Dependency=function(a){this.url=a,this.status="request",this.message=""},yOSON.Dependency.prototype.request=function(){console.log("solicitando url",this.url);var a=this,b=document.createElement("script");b.type="text/javascript",b.src=this.url,b.readyState?this.requestIE(b):(b.onload=function(){a.status="ready"},b.onerror=function(){a.onErrorRequest()}),document.getElementsByTagName("head")[0].appendChild(b)},yOSON.Dependency.prototype.requestIE=function(a){var b=this;a.onreadystatechange=function(){"loaded"==a.readyState||"complete"==scr.readyState?(scr.onreadystatechange=null,b.status="ready"):b.onErrorRequest()}},yOSON.Dependency.prototype.onErrorRequest=function(){this.status="error",this.setErrorMessage("No pudo cargarse el script "+this.url)},yOSON.Dependency.prototype.getStatus=function(){return this.status},yOSON.Dependency.prototype.getErrorMessage=function(){return this.message},yOSON.Dependency.prototype.setErrorMessage=function(a){this.message=a},yOSON.DependencyManager=function(){this.data={},this.loaded={},this.config={staticHost:"",versionUrl:""}},yOSON.DependencyManager.prototype.setStaticHost=function(a){this.config.staticHost=a},yOSON.DependencyManager.prototype.setVersionUrl=function(a){this.config.versionUrl=a},yOSON.DependencyManager.prototype.getVersionUrl=function(){var a="";return""!=this.config.versionUrl&&(a="?"+this.config.versionUrl),a},yOSON.DependencyManager.prototype.transformUrl=function(a){var b="",c=/((http?|https):\/\/)(www)?([\w-]+\.\w+)+(\/[\w-]+)+\.\w+/g;return b=c.test(a)?a:this.config.staticHost+a+this.getVersionUrl()},yOSON.DependencyManager.prototype.generateId=function(a){return-1!=a.indexOf("//")?a.split("//")[1].split("?")[0].replace(/[/.:]/g,"_"):a.split("?")[0].replace(/[/.:]/g,"_")},yOSON.DependencyManager.prototype.addScript=function(a){var b=this.generateId(a);this.alreadyInCollection(b)?console.log("dependency in cache",this.data[b]):(this.data[b]=new yOSON.Dependency(a),this.data[b].request())},yOSON.DependencyManager.prototype.ready=function(a,b){var c=0,d=this,e=function(f){var g=d.transformUrl(f[c]);c<f.length?(d.addScript(g),d.avaliable(g,function(){c++,e(a)})):b.apply(d)};e(a)},yOSON.DependencyManager.prototype.avaliable=function(a,b){var c=this,d=c.generateId(a),e=c.getDependency(a);if(this.alreadyLoaded(d))return!0;var f=setInterval(function(){"ready"==e.getStatus()&&(c.loaded[d]=!0,clearInterval(f),b.apply(c)),"error"==e.getStatus()&&(console.warn(e.getErrorMessage()),clearInterval(f),b=null)},500)},yOSON.DependencyManager.prototype.getDependency=function(a){var b=this.generateId(a);return this.data[b]},yOSON.DependencyManager.prototype.alreadyInCollection=function(a){return this.data[a]},yOSON.DependencyManager.prototype.alreadyLoaded=function(a){return this.loaded[a]},yOSON.Modular=function(){this.modules={},this.runningModules={},this.skeletonModule={},this.entityBridge={},this.debug=!1},yOSON.Modular.prototype.addMethodToBrigde=function(a,b){this.entityBridge[a]=b},yOSON.Modular.prototype.addModule=function(a,b){this.existsModule(a)||(this.modules[a]=this.createDefinitionModule(a,b))},yOSON.Modular.prototype.getModuleDefinition=function(a){var b=this.getModule(a),c=b.moduleDefinition(this.entityBridge),d=this;for(var e in c){var f=c[e];"function"==typeof f&&(c[e]=d.addFunctionToDefinitionModule(a,e,f))}return c},yOSON.Modular.prototype.addFunctionToDefinitionModule=function(a,b,c){return function(){try{return c.apply(this,arguments)}catch(d){console.log("Modulo:"+a+"."+b+"(): "+d.message)}}},yOSON.Modular.prototype.existsModule=function(a){var b=!1;return this.getModule(a)&&(b=!0),b},yOSON.Modular.prototype.getModule=function(a){return this.modules[a]},yOSON.Modular.prototype.createDefinitionModule=function(a,b){return this.skeletonModule[a]={moduleDefinition:b},this.skeletonModule[a]},yOSON.Modular.prototype.runModule=function(a,b){var c=null;if(this.existsModule(a)){console.log("running Module:",a),c="undefined"==typeof b?{}:b,c.moduleName=a;var d=this.getModuleDefinition(a);this.runningModule(a),d.hasOwnProperty("init")&&d.init(c)}},yOSON.Modular.prototype.runModules=function(a){var b=this;if(!(!a instanceof Array))for(var c=0;c<a.length;c++){var d=a[c];b.existsModule(d)&&b.runModule(d)}},yOSON.Modular.prototype.runningModule=function(a){this.modules[a].running=!0},yOSON.Modular.prototype.moduleIsRunning=function(a){return this.modules[a].running},yOSON.Modular.prototype.setStatusModule=function(a,b){this.modules[a].status=b},yOSON.Modular.prototype.getStatusModule=function(a){return this.modules[a].status},yOSON.Modular.prototype.allModulesRunning=function(a,b){var c=this,d=setInterval(function(){var e=0,f=0;for(var g in c.modules)c.moduleIsRunning(g)&&f++,"start"==c.getStatusModule(g)&&e++;e>0?e==f?(b.call(c),clearInterval(d)):a.call(c):(b.call(c),clearInterval(d))},200)},yOSON.Comunicator=function(){this.events={}},yOSON.Comunicator.prototype.publish=function(a,b){var c=this;this.finderEvents([a],function(d,e){var f=e.instanceOrigin,g=e.functionSelf,h=c.validateArguments(b);console.log("execute event",a),g.call(f,h)},function(){})},yOSON.Comunicator.prototype.subscribe=function(a,b,c){var d=this;this.finderEvents(a,function(){},function(a){console.log("register event",a),d.addEvent(a,b,c)})},yOSON.Comunicator.prototype.validateArguments=function(a){var b=[];return"undefined"!=typeof a&&(b=a),b},yOSON.Comunicator.prototype.stopSubscribe=function(a){var b=this;this.finderEvents(a,function(a){b.removeEvent(a)},function(){})},yOSON.Comunicator.prototype.addEvent=function(a,b,c){var d={};return d.instanceOrigin=c,d.functionSelf=b,this.events[a]=d,this},yOSON.Comunicator.prototype.removeEvent=function(a){this.events[a]=null},yOSON.Comunicator.prototype.eventAlreadyRegistered=function(a){var b=null;return this.getEvent(a)&&(b=!0),b},yOSON.Comunicator.prototype.getEvent=function(a){return this.events[a]},yOSON.Comunicator.prototype.finderEvents=function(a,b,c){for(var d=this,e=0;e<a.length;e++){var f=a[e];if(d.eventAlreadyRegistered(f)){var g=d.getEvent(f);b.call(d,f,g)}else c.call(d,f)}},yOSON.Loader=function(a){this.schema=a,this.modules=this.schema.modules,this.controllers={},this.actions={}},yOSON.Loader.prototype.init=function(a,b,c){var d=this.checkLevelName(a),e=this.checkLevelName(b),f=this.checkLevelName(c);this.runModuleLevel(d,function(a){this.runControllerLevel(a,e,function(a){this.runActionLevel(a,f,function(a){a()},function(a){this.getByDefaultInActionLevel(a)})},function(a){this.getByDefaultInControllerLevel(a)})},function(){this.getByDefaultInModuleLevel()})},yOSON.Loader.prototype.checkLevelName=function(a){var b="";return"undefined"==typeof a||(b=a),b},yOSON.Loader.prototype.getModuleByName=function(a){return this.modules[a]},yOSON.Loader.prototype.existsModuleByName=function(a){var b=!1;return this.getModuleByName(a)&&(b=!0),b},yOSON.Loader.prototype.getByDefaultInModuleLevel=function(){if("function"!=typeof this.modules.byDefault)throw new Error("The level module dont have the default module or not is a function");this.modules.byDefault()},yOSON.Loader.prototype.runModuleLevel=function(a,b,c){if(this.schema.modules.allModules(),this.existsModuleByName(a)){var d=this.getModuleByName(a);b.call(this,d)}else c.call(this)},yOSON.Loader.prototype.getControllerByNameInModule=function(a,b){return b.controllers[a]},yOSON.Loader.prototype.existsControllerByName=function(a,b){var c=!1;return this.getControllerByNameInModule(b,a)&&(c=!0),c},yOSON.Loader.prototype.getByDefaultInControllerLevel=function(a){if("function"!=typeof a.controllers.byDefault)throw new Error("The level controller don't have the default controller or not is a function");a.controllers.byDefault()},yOSON.Loader.prototype.runControllerLevel=function(a,b,c,d){if(a.allControllers(),this.existsControllerByName(a,b)){var e=this.getControllerByNameInModule(b,a);c.call(this,e)}else d.call(this,a)},yOSON.Loader.prototype.getActionByNameInController=function(a,b){return b.actions[a]},yOSON.Loader.prototype.existsActionInController=function(a,b){var c=!1;return this.getActionByNameInController(b,a)&&(c=!0),c},yOSON.Loader.prototype.getByDefaultInActionLevel=function(a){if("function"!=typeof a.actions.byDefault)throw new Error("The level action don't have the default controller or not is a function");a.actions.byDefault()},yOSON.Loader.prototype.runActionLevel=function(a,b,c,d){if(a.allActions(),this.existsActionInController(a,b)){var e=this.getActionByNameInController(b,a);c.call(this,e)}else d.call(this,a)},yOSON.AppCore=function(){var a=new yOSON.Modular,b=new yOSON.DependencyManager,c=new yOSON.Comunicator,d={};a.addMethodToBrigde("events",function(a,b,d){c.subscribe(a,b,d)}),a.addMethodToBrigde("trigger",function(b,d){var e={};console.log("corriendo evento",b),a.allModulesRunning(function(){e[b]=d},function(){for(var a in e)c.publish(a,e[a]);c.publish(b,d)})});var e=function(a,b){d[a]=b},f=function(a){var b=[];return d[a]&&(b=d[a]),b};return{addModule:function(b,c,d){e(b,d),a.addModule(b,c)},runModule:function(c,d){var e=f(c);a.setStatusModule(c,"start"),b.ready(e,function(){a.runModule(c,d)})},setStaticHost:function(a){b.setStaticHost(a)},setVersionUrl:function(a){b.setVersionUrl(a)}}}();